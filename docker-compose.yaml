version: '3.8'
services:
  postgres:
    container_name: nest-clean-pg
    image: postgres
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: docker
      POSTGRES_DB: nest-clean
      PGDATA: /data/postgres
    volumes:
      - ./data/pg:/data/postgres
    networks:
      - backend-network

  backend:
    build: ./
    # container_name: forum-api
    # ports:
    #   - '3333:3333'
    environment:
      - DATABASE_URL=postgresql://postgres:docker@nest-clean-pg:5432/postgres?schema=public
      - PORT=3333
      - JWT_PRIVATE_KEY=LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRUUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1Nzd2dna25BZ0VBQW9JQ0FRRENzSFBIMHdWbXFlZm8KaXBBTElvOFFORXdIRy9tb2FZT1drekdzZnlyY2FYWVMrV0Uwa285NysyWi82RDFzMHNBL3FuN24vUkhmL0dYcgpsVHZXRjhnQ3EzMjMvMDFpYkRpbC9nOTRNd2NwMDNGU0tyRWpRdGV4dVU1SVp5WkVyT3lVdmVTUHV4Rjk0SlROCjdkSi9yZmpFVG85Y01lN0JnemJLcUk0ZzZmNW1UdHlIVzhOOHRhUmhhRUZTbTgzaHlxVloyRmxRYy91LzBSNnUKNEVURG9lblI0enFvc1ZlVXA2R0tJUngyQmtLY0FmT0IrbVN6Q3RpM1o5V3ZnRGhPcG5VY3JKOVlvQWVXYmxsQQo2Zm1iTlpFMC9iZmo0Q1FFemNmOW14TkRpKzVBRWs0ZVZ6RG1GZEVHTDd4eGZWM0tHc05VTkZpWkxWNVVDQjFsCnA5RVdGK0NXZEhueC82ZVMwMWZVZmxWTWxjUDFBcTVCU0tsbm5EcVhnRDQ5elp3T2tMS016ZVFCNTE4SHZNdHAKQnZ3RjJ3R012ZDNOc2wzNDVLWGRPbVZPZlFTOGdZQVVyYm5yVVJDbGEveGZEVFZYcjltWkVwTTZiWStjL0FNegpxRWsvcDVWRjdaMHU0Rm5qM25LU2VITldRYzZIWmJ6K0l6TlJ3WHd4d2pOa2VNYThZOXZZZTJCZmhNU21WYldxCnBiS1phWE1rbnJ5TTJlVG4rM3VOVlh6M2tKZHFmb3BlYktsV3I0UDNPQ3M4ZU9DUDZISy9rd21oU1Urd0VIb04KUlAxcXRUWVF0MytXRHA1VVNCMTFBVzlEcVNBWjZwaURpQU1OYi9lRlgrZ2V6VVlTc1g1c2tFOCtEYzd4dVh5cwpFQUkzWnMxTndLaHZhSDJOMW5ua1R1NG4xZmI3eXdJREFRQUJBb0lDQUFQWHNybFBiMnhhenlKMlZhaDZtcU5CCnZQeG83M0VGQUIxaE0xcEp1a0ZXYlllclYyRlB3VGc3dW9hc3dVV2NGVUpNYmF2TGdXWlAxMzBpV1dkODJhdy8KMFQvbjhKR1FQRC8rZHpTeW9TSVFzOHhnM2xVcFZST0Rha21naTQ5UWNHenhJSWs3c25rdkRSRFJjRldueStDbwpBa2xhRFBIUjBxdUdUeVBVS25xL2RMZlJObGNJU01ISmFueWthWmhheFErMFp2TGhEeWQyaTZuODhDNkNUQmloCjZQNzZYUldvaDFZd0dCMDJPMnRUMklnSXRxTVlCRFgrZlNlMUdxZG12cW45dURscUV5eERha3lQTWFlQUU2a2QKbHRzUENmYjBUczJ4R1Z5OGJzdmg4SnZGc2NmZ3gxcmRaMVZBR2JGSy9PNzFCNGlpYmhtdmZWRUwwbU1pdm9LQQowOHA4OWx4NFNEUmRwd0M2L0RxR0g3enlHLzFsakNVY3ZPTllCS21IbkVkcCtTdG1TNFlKRWJjZWV3UUtadUtICml5U2hxZ0lEaGtOZ2VUR0dRVkttLzMzMUFWbU9OcXppNjZBcmIzejkwWTNtZUowSXZTNi8xNHcvL1ZDbzhXRi8KdlV5QjRWSnl4Zm02UE1ZOElZZmwrNXJGb3lCMWhsUnFIVklrSVFzTW5jb2ZTejV1VFpjWDFiR2JZeDRCTVBaawpDTU8vWTRYMzRtOHhkaU5MUDQ5M1NzRWR1ZFlVVXZDUVJFTFlLaTRIbm5Fc21tcnN6d0JvYUdLeW5NUTVJb0F3ClNWYUpPYmpWVXkvRFN1N3hqeDhkUDV2djNnbEk5S1BLUTB0ZUZ1T20rclJHN1BLMittNmcrWVBtQXNITGZJMzcKdjR4a1lPMjBVUjJMazBHOE5CbEZBb0lCQVFENnN5Q3FpYjkwbERjdnJBSTJmVkpoMExjQ2NVRm85SU8rWWJDZgpjNnJreXdRQnNQUHhiSSs0NWpyRnQzbmEyTmYvbzJaQ2dzZVYxNEUxaHIrYW1qd0Y1Q3drY1c0MnZMOW9QYzA1CkNpbGUxUG9ZemlKeUVNQStNek1BcmMyTmlTZHdaNU5IekkxbFJheGdzRWlUZGdNaXZzTE8vV0xYYVBhL2JMNlkKZ0hKU1grd0VPZ0hibHRzTTlWbGNVOHZpZGF6NG5kK0h0UFhUQmdVaytyd3dHbW51RTFSWHQ4VXVOKzJLOGxHMAp0Z2Y0UU1ObGtFM2pyU050NHVrb3pieDV6NnBkWmlxOWc4QVlTTTkySGJwV0p3cGYzUjVLbEY3bGJqbVVqb0FPCnd0a2VyN3gxMlpLQ1h0c2pmdkJjN2FCN3BXaVBBblFRZDQrNDRrZzcyUm1vQmRjL0FvSUJBUURHemkxUHpYeU8Kbjl5cTZpRk93aUdGQWI2TnJiVklvOXN0YlU3MGtHSUl3MmtVNm5JY2ppa2c4Rk5USnZScWMrMHBqOFRLZVA0awpHZUgxaEdqTDRsczJOa29DUHZvU2R1akVOa241Y2FiN2dyODYrcm9hSVEzUnBOYmpROWI4YzRvNmpZZjNsWHgwCkpNakNkaEluSG14cEZ6ZWVwVmJKMjI1aFZPV0QwQm1scDFGN3VuV0FBa1lhbExCM2NJbVZER1MvdUFEb3BXOTAKZWhHUHZQWWhTTFg2LzFJRzVyakNUcnRjZ2pqQ0xxWVBrZW9vbTF4MHlqQWcvNTQ0L1ZnbzJkRmRxQXptWUxvdApRUHlINmtjNUNKQURVTWhtRzlOQmJDZC9JeEhCSWpNcTFTc1VrNkJIT2xWeERVdGhBODR2M0g4Y0t5WTAxSmpWCnI4aEZNWDVPQ1dSMUFvSUJBRVRkQTNJVTJHUmJlalU4R0hlRFFTZmhQd1FLdkI3cVcyM21RNi9wQTk1STdkYlIKRnBFUWN3SWxLNnUzMUY4TEJYb1JGanZhMUp3U1VFbTFzOWZ4MmQ3OGFDdXloTVhBWHd0eFBuZ1dsSHFhSWdEQwpUcS9xYmdRbjZEQ2RqVUw5azduS21hZzFSZm0xZzc0amJpd2pWSVVzeFRJNlkvWXJ2T3VrSVU2ZXFjaDYxTWZzCmJ5bzBiQU5KT2J5a3YvSjZ4SUtlU3hKcDRNU1FlTVZKb252TUphRGg2bDhWK2JIU1p3dXR1RWZkWUo4T214M0EKMzhSVWdORGtiWXRweUFYbHh6UlVwaFRjcGQyRjBvYnRiNHZPdVlqUG9reDJLUUw0bmhSeWVEYVZ5eklrcjYzbgpqOWtEMlVvTXlsV2NhR0xPY3NRbHRsLzNsNkQvZHp3SlRJVGM1ZDBDZ2dFQVh5VXJrR2JTdHR1Ulc0Y0QrOUp6CkFsbnNYWmdHQzhiSHpiempyYTR3RE91Z3JlN3FQL3BWZXJzcDFjRHQ5c2lXZDI2a0N4Yk80bTQwc3pEMGlxZEIKYWZlZmdlV3Ivd3hEcUN3blNTZDRlQ1NCNnZNMS8rMVQxTUtrU1U0ZFpPTFRBK1RhYnNadk1wS3NOazBWc1AwaAplMFl1UzFIcjhGMkJQVG5KUWtWbEVOKzc0cEJCVGN0SXk4M2Zpcm9rVGw0SkZhdzFXeUpaN2cvQnVkNEFtYnRYCnhORk82NWllVWZnbU9VYmxiU0d3UGdGaVpKNitKL0xnQjlydVdXMytORWJTcVpVVTMyanBrV0RwdXc2SG1hY2MKYlVuTEx2c2dKczVoTkxxTzg3U3ZjazlrOThzVFNTT0U0cjh2RlRZaUJzdnJWWXJkRlNtdUg0NnFOVnRUakh0NApSUUtDQVFBLzFUM2pPbFZLb0pxVDBHQ2xqbSs5dndGMWRTM3RXamx1c2lBNElHUHlmdWJ4bUNYMVR3ZTBESzVUClBiN2srUFFuNXhhQTVvNWlEamJrVm1hYlU0emlZeHdScVkyeWhBTHJFckYyYTlqcmJwMnYveGFsVUxNOVFWT0kKMGlVRVZaWVEyWWsyQzZ1VURNMkFDby81UThNSTRZY0FqM2pENEJDVjJja0w2QndzUEE3RHVORUQ3SWJRZzY0LwpobC9QRnZTT1lPWkUzcU4yaVI2WDBRWm9EWEEzcDRYSThzdGFMUytCZE1IcUhHVE0vTHRqNVZWRHNESnZ3ai9tCjBBc3hLQkpCNUNvWnZnaVJwNGtwLzZWRVh3OVFrcis2T2t5c1VBYXhxZFNPZTNYSGR1SU4vRGFkL29YMFhMaS8KdmIxNm01djlhTDZVODJFeStQVXRBekJ3YU5YRQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==
      - JWT_PUBLIC_KEY=LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQ0lqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FnOEFNSUlDQ2dLQ0FnRUF3ckJ6eDlNRlpxbm42SXFRQ3lLUApFRFJNQnh2NXFHbURscE14ckg4cTNHbDJFdmxoTkpLUGUvdG1mK2c5Yk5MQVA2cCs1LzBSMy94bDY1VTcxaGZJCkFxdDl0LzlOWW13NHBmNFBlRE1IS2ROeFVpcXhJMExYc2JsT1NHY21SS3pzbEwza2o3c1JmZUNVemUzU2Y2MzQKeEU2UFhESHV3WU0yeXFpT0lPbitaazdjaDF2RGZMV2tZV2hCVXB2TjRjcWxXZGhaVUhQN3Y5RWVydUJFdzZIcAowZU02cUxGWGxLZWhpaUVjZGdaQ25BSHpnZnBrc3dyWXQyZlZyNEE0VHFaMUhLeWZXS0FIbG01WlFPbjVteldSCk5QMjM0K0FrQk0zSC9ac1RRNHZ1UUJKT0hsY3c1aFhSQmkrOGNYMWR5aHJEVkRSWW1TMWVWQWdkWmFmUkZoZmcKbG5SNThmK25rdE5YMUg1VlRKWEQ5UUt1UVVpcFo1dzZsNEErUGMyY0RwQ3lqTTNrQWVkZkI3ekxhUWI4QmRzQgpqTDNkemJKZCtPU2wzVHBsVG4wRXZJR0FGSzI1NjFFUXBXdjhYdzAxVjYvWm1SS1RPbTJQblB3RE02aEpQNmVWClJlMmRMdUJaNDk1eWtuaHpWa0hPaDJXOC9pTXpVY0Y4TWNJelpIakd2R1BiMkh0Z1g0VEVwbFcxcXFXeW1XbHoKSko2OGpObms1L3Q3alZWODk1Q1hhbjZLWG15cFZxK0Q5emdyUEhqZ2oraHl2NU1Kb1VsUHNCQjZEVVQ5YXJVMgpFTGQvbGc2ZVZFZ2RkUUZ2UTZrZ0dlcVlnNGdERFcvM2hWL29IczFHRXJGK2JKQlBQZzNPOGJsOHJCQUNOMmJOClRjQ29iMmg5amRaNTVFN3VKOVgyKzhzQ0F3RUFBUT09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQo=
    depends_on:
      - postgres
    networks:
      - backend-network
  
  nginx:
    image: nginx:latest
    volumes:
      - ./conf.d:/etc/nginx/conf.d
    depends_on:
      - backend
    ports:
      - '3333:3333'
    networks:
      - backend-network
networks:
  backend-network:
    driver: bridge
